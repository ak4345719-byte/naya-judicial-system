{% extends "base.html" %}

{% block title %}Analytics - Naya Judicial System{% endblock %}

{% block head %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
{% endblock %}

{% block content %}
<div class="space-y-8">
    <header class="flex justify-between items-center">
        <div>
            <h1 class="text-2xl font-bold text-gray-800">Judicial Analytics</h1>
            <p class="text-gray-600">Deep dive into court performance and case trends.</p>
        </div>
        <button onclick="loadCharts()" class="text-sm text-indigo-600 hover:text-indigo-800 font-medium">
            <i class="fas fa-sync-alt"></i> Refresh Data
        </button>
    </header>

    
    

    
    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">

        
        <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">Case Status Distribution</h3>
            <div class="h-64">
                <canvas id="statusChart"></canvas>
            </div>
        </div>

        
        <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">Filings Trend (Monthly)</h3>
            <div class="h-64">
                <canvas id="trendChart"></canvas>
            </div>
        </div>

        
        <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100 md:col-span-2">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">Judge Utilization (Hearings Assigned)</h3>
            <div class="h-64">
                <canvas id="judgeChart"></canvas>
            </div>
        </div>

    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    let statusChart, trendChart, judgeChart;

    async function loadCharts() {
        try {
            const res = await fetch('/api/analytics/data');
            const data = await res.json();

            
            const ctxStatus = document.getElementById('statusChart').getContext('2d');
            if (statusChart) statusChart.destroy();
            statusChart = new Chart(ctxStatus, {
                type: 'doughnut',
                data: {
                    labels: data.status_distribution.labels,
                    datasets: [{
                        data: data.status_distribution.values,
                        backgroundColor: ['#4f46e5', '#10b981', '#f59e0b', '#ef4444', '#6b7280']
                    }]
                },
                options: { maintainAspectRatio: false }
            });

            
            const ctxTrend = document.getElementById('trendChart').getContext('2d');
            if (trendChart) trendChart.destroy();
            trendChart = new Chart(ctxTrend, {
                type: 'line',
                data: {
                    labels: data.monthly_trend.labels,
                    datasets: [{
                        label: 'Cases Filed',
                        data: data.monthly_trend.values,
                        borderColor: '#4f46e5',
                        backgroundColor: 'rgba(79, 70, 229, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: { maintainAspectRatio: false, scales: { y: { beginAtZero: true } } }
            });

            
            const ctxJudge = document.getElementById('judgeChart').getContext('2d');
            if (judgeChart) judgeChart.destroy();
            judgeChart = new Chart(ctxJudge, {
                type: 'bar',
                data: {
                    labels: data.judge_load.labels,
                    datasets: [{
                        label: 'Hearings Assigned',
                        data: data.judge_load.values,
                        backgroundColor: '#10b981'
                    }]
                },
                options: { maintainAspectRatio: false, scales: { y: { beginAtZero: true } } }
            });

        } catch (err) {
            console.error("Failed to load analytics:", err);
        }
    }

    
    loadCharts();
</script>
{% endblock %}